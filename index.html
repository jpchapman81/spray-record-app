<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Julius Ag Spray Record</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 600px; }
    input, select, textarea { margin: 5px 0; padding: 8px; width: 100%; }
    button { padding: 10px 20px; margin-top: 15px; }
    canvas { width: 100%; height: 150px; border: 1px solid black; }
  </style>
</head>
<body>

<h2>Julius Ag Spray Record</h2>

<form id="sprayForm">

  <label>Job Number:</label>
  <input type="text" id="jobNumber" value="1000" readonly>

  <label>Date:</label>
  <input type="date" id="date" required>

  <label>Company:</label>
  <select id="company" onchange="toggleCustomCompany()" required>
    <option value="">Select Company</option>
    <option value="Julius Ag">Julius Ag</option>
    <option value="Laramie Energy">Laramie Energy</option>
    <option value="QB Energy">QB Energy</option>
    <option value="Other">Other</option>
  </select>

  <div id="customCompanyContainer" style="display:none;">
    <label>Enter Custom Company Name:</label>
    <input type="text" id="customCompany">
  </div>

  <label>Location:</label>
  <input type="text" id="location" required>

  <label>Ownership:</label>
  <select id="ownership" required>
    <option value="">Select Ownership</option>
    <option value="Private">Private</option>
    <option value="Public">Public</option>
    <option value="Federal">Federal</option>
    <option value="Other">Other</option>
  </select>

  <label>Sprayer Type:</label>
  <select id="sprayerType" required>
    <option value="">Select Sprayer Type</option>
    <option value="Boom">Boom</option>
    <option value="Backpack">Backpack</option>
    <option value="ATV">ATV</option>
    <option value="Truck Mount">Truck Mount</option>
  </select>

  <label>Calibration Rate (gal/acre):</label>
  <input type="number" id="calibrationRate" step="1" min="1" required>

  <label>Gallons Applied:</label>
  <input type="number" id="gallonsApplied" step="1" min="1" required>

  <label>Tank Mix:</label>
  <select id="tankMix" onchange="updateChemicals()" required>
    <option value="">Loading mixes...</option>
  </select>

  <div id="chemicalsTableContainer"></div>

  <label>Applicators:</label>
  <input type="text" id="applicators" required>

  <label>Weather Conditions:</label>
  <input type="text" id="weather" required>

  <label>GPS Coordinates:</label>
  <input type="text" id="gps" required>

  <h3>Signature:</h3>
  <canvas id="signatureCanvas"></canvas>
  <button type="button" onclick="clearSignature()">Clear Signature</button>

  <br><br>
  <button type="button" onclick="submitForm()">Submit Record</button>
  <button type="button" onclick="clearForm()">Clear Record</button>


</form>

<script>
function toggleCustomCompany() {
  const companySelect = document.getElementById("company");
  const customContainer = document.getElementById("customCompanyContainer");
  if (companySelect.value === "Other") {
    customContainer.style.display = "block";
  } else {
    customContainer.style.display = "none";
    document.getElementById("customCompany").value = "";
  }
}

document.getElementById('tankMix').addEventListener('change', function() {
  const mix = this.value;
  let chemicals = '';
  if (mix === 'Esplanade Mix') {
    chemicals = "Esplanade 432-1516: 5 oz\nAntares Pro 82534-5-5905: 10 oz\nRoundup Pro 524-529: 64 oz\nGrounded: 32 oz\nDye: 32 oz";
  } else if (mix === 'Trumpcard Mix') {
    chemicals = "TrumpCard 5905-581: 48 oz\nVision 5905-576: 13 oz\nInduce: 20.48 oz\nDye: 16 oz";
  } else if (mix === 'Milestone Mix') {
    chemicals = "TrumpCard 5905-581: 48 oz\nMilestone 62719-519: 6 oz\nTelar 264-770: 1 oz\nInduce: 20.48 oz\nDye: 16 oz";
  }
  document.getElementById('chemicals').value = chemicals;
});

function clearSignature() {
  const canvas = document.getElementById('signatureCanvas');
  const context = canvas.getContext('2d');
  context.clearRect(0, 0, canvas.width, canvas.height);
}

const signaturePad = (() => {
  const canvas = document.getElementById('signatureCanvas');
  const ctx = canvas.getContext('2d');
  let drawing = false;

  canvas.addEventListener('mousedown', e => {
    drawing = true;
    ctx.moveTo(e.offsetX, e.offsetY);
  });

  canvas.addEventListener('mousemove', e => {
    if (drawing) {
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
    }
  });

  canvas.addEventListener('mouseup', () => drawing = false);
  canvas.addEventListener('mouseout', () => drawing = false);

  return {
    toDataURL: () => canvas.toDataURL()
  };
})();

function submitForm() {
  const companySelect = document.getElementById("company").value;
  const customCompany = document.getElementById("customCompany").value;
  const company = companySelect === "Other" ? (customCompany || "Other") : companySelect;
  const ownership = document.getElementById("ownership").value;
  const sprayer = document.getElementById("sprayerType").value;
  const rate = parseInt(document.getElementById("calibrationRate").value, 10);
  const gallons = parseInt(document.getElementById("gallonsApplied").value, 10);
  const acresTreated = (gallons / rate).toFixed(2);

  const newWindow = window.open('', '', 'width=800,height=1000');
  newWindow.document.write('<html><body>');
  newWindow.document.write('<h2>Julius Ag Spray Record</h2>');
  newWindow.document.write('<p><strong>Company:</strong> ' + company + '</p>');
  newWindow.document.write('<p><strong>Ownership:</strong> ' + ownership + '</p>');
  newWindow.document.write('<p><strong>Sprayer Type:</strong> ' + sprayer + '</p>');
  newWindow.document.write('<p><strong>Calibration Rate (gal/acre):</strong> ' + rate + '</p>');
  newWindow.document.write('<p><strong>Gallons Applied:</strong> ' + gallons + '</p>');
  newWindow.document.write('<p><strong>Acres Treated:</strong> ' + acresTreated + '</p>');
  newWindow.document.write('<p><strong>Chemicals Used:</strong></p>');
  newWindow.document.write(document.getElementById("chemicalsTableContainer").innerHTML);
  newWindow.document.write('<p><strong>Signature:</strong><br><img src="' + signaturePad.toDataURL() + '" width="300"></p>');
  newWindow.document.write('</body></html>');
  newWindow.document.close();
  newWindow.print();

   // Increment job number
   const jobInput = document.getElementById("jobNumber");
   jobInput.value = parseInt(jobInput.value) + 1;

   // Clear only the signature
   clearSignature();
}

  function clearForm() {
    const jobNumber = document.getElementById("jobNumber").value;
    document.getElementById("sprayForm").reset();
    document.getElementById("jobNumber").value = jobNumber;
    clearSignature();
    toggleCustomCompany();
}

let tankMixData = [];

fetch("https://opensheet.elk.sh/18G6oH9M5SrvJ2gCRLXQgvqB_8KO4qcYL5dUNZtw4VnM/Tank%20Mixes")
  .then(res => res.json())
  .then(data => {
    tankMixData = data;
    const tankMixSelect = document.getElementById("tankMix");
    tankMixSelect.innerHTML = '<option value="">Select Mix</option>';
    data.forEach(row => {
      const opt = document.createElement("option");
      opt.value = row.Name;
      opt.textContent = row.Name;
      tankMixSelect.appendChild(opt);
    });
  })
  .catch(err => {
    console.error("Error loading mixes:", err);
    document.getElementById("tankMix").innerHTML = '<option value="">Error loading</option>';
  });

  function updateChemicals() {
    const selectedName = document.getElementById("tankMix").value;
    const row = tankMixData.find(mix => mix.Name === selectedName);
    if (!row) return;

    const tableHTML = ['<table border="1" cellpadding="6"><tr><th>Chemical</th><th>Amount</th></tr>'];

    let i = 1;
    while (row[`Chemical${i}`] || row[`Amount${i}`]) {
      const chem = row[`Chemical${i}`] || '';
      const amt = row[`Amount${i}`] || '';
      if (chem || amt) {
        tableHTML.push(`<tr><td>${chem}</td><td>${amt}</td></tr>`);
      }
      i++;
    }

    tableHTML.push('</table>');
    document.getElementById("chemicalsTableContainer").innerHTML = tableHTML.join('');
  }

</script>

</body>
</html>
